schema_version: v7.1
description: >-
  Validation thresholds and gates for stability metrics in OrderFlow V7.1.
  These thresholds define the acceptable ranges for various stability and
  performance metrics used in the model validation pipeline.

# Core stability metrics
stability:
  stability_index:
    threshold: 0.60
    description: "Minimum stability index for model release"
    gate: "fail_below"
  
  noise_energy:
    threshold: 0.30
    description: "Maximum allowed noise energy in low clarity intervals"
    gate: "fail_above"

# Dynamic thresholds for drift and spectrum analysis
drift:
  drift_bandwidth:
    warn: 0.08
    fail: 0.12
    description: "Bandwidth proxy using first-order differences of prototypes"
    unit: "normalized_units"
  
  prototype_drift:
    warn: 0.12
    fail: 0.15
    lookback_windows: 96
    description: "Scaled Euclidean drift of cluster centroids"

# Clarity and spectrum metrics
clarity:
  clarity_spectrum_power:
    baseline: 0.001
    warn: 0.005
    fail: 0.010
    description: "High-frequency power in clarity spectrum (Welch's method)"
    frequency_band: "upper_half_nyquist"
  
  clarity_gate:
    threshold: 0.45
    description: "Minimum clarity for non-abstain decisions"

# Robustness metrics
robustness:
  adversarial_gap:
    warn: 0.15
    fail: 0.25
    description: "Mean squared distance between real and noisy embeddings"
    noise_scale: 0.1

# Calibration metrics (inherited from v7.0)
calibration:
  ece:
    warn: 0.06
    fail: 0.08
    description: "Expected calibration error"
  
  brier:
    warn: 0.16
    fail: 0.18
    description: "Brier score"

# Performance metrics
performance:
  transition_hit_ratio:
    min: 0.60
    description: "Minimum hit ratio for transition predictions"
  
  abstain_rate:
    min: 0.10
    max: 0.25
    description: "Acceptable range for abstain rate"

# Reporting configuration
reporting:
  output_format: ["json", "markdown"]
  include_timestamp: true
  include_git_hash: true
  
gates:
  # Critical gates that must pass for release
  critical:
    - stability_index
    - noise_energy
    - prototype_drift
    - ece
    - brier
  
  # Warning gates that should be monitored
  warning:
    - drift_bandwidth
    - clarity_spectrum_power
    - adversarial_gap
  
  # Info gates for monitoring only
  info:
    - transition_hit_ratio
    - abstain_rate

signatures:
  version: "7.1"
  last_reviewed: 2025-10-28
  reviewer: stability-committee
